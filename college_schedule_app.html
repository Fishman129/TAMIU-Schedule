<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>College Schedule — Timeline</title>
<style>
:root{
  --bg:#0b0f14; --card:#0f161b; --muted:#9aa6b2; --text:#e6eef6;
  --grid:#1b2730; --now:#ff5b6b;
  --accent-math:#2563eb; --accent-engl:#16a34a; --accent-biol:#8b5cf6;
  --accent-univ:#f59e0b; --accent-hist:#ef4444; --accent-lab:#06b6d4;
  --break:#6b7280;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
}
@media (prefers-color-scheme: light){
  :root{
    --bg:#f6f8fb; --card:#ffffff; --muted:#5b6a75; --text:#09121a;
    --grid:#e6eef6; --now:#d92b35;
  }
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
.app{max-width:980px;margin:0 auto;padding:12px 14px 40px}
.header{display:flex;align-items:center;gap:12px;position:sticky;top:0;background:color-mix(in srgb,var(--bg) 90%, transparent);backdrop-filter:blur(8px);padding:10px;border-bottom:1px solid rgba(255,255,255,0.03);z-index:40}
.title{font-weight:800;font-size:17px}
.controls{margin-left:auto;display:flex;gap:8px;align-items:center}
.btn{background:var(--card);border:1px solid rgba(255,255,255,0.03);padding:8px 10px;border-radius:10px;font-weight:700}
.tabs{display:flex;gap:6px;margin:12px 0}
.tab{padding:8px 11px;border-radius:10px;background:var(--card);border:1px solid rgba(255,255,255,0.03);font-weight:700;cursor:pointer}
.tab.active{background:linear-gradient(180deg,color-mix(in srgb,var(--card) 60%, transparent),transparent);box-shadow:0 8px 24px rgba(2,6,23,.35)}
.layout{display:flex;gap:12px}
.sidebar{width:120px;min-width:96px}
.hours{display:flex;flex-direction:column;gap:4px;padding-top:8px}
.hour{height:48px;display:flex;align-items:center;color:var(--muted);font-size:12px;padding-left:6px}
.canvas{flex:1;overflow:auto;border-radius:12px;background:linear-gradient(180deg, color-mix(in srgb,var(--card) 98%, transparent), transparent);padding:8px;border:1px solid rgba(255,255,255,0.03)}
.day-col{min-width:100%;position:relative;padding:8px}
.grid-line{position:absolute;left:0;right:0;height:48px;border-top:1px dashed rgba(255,255,255,0.03)}
.event{position:absolute;border-radius:10px;padding:8px 10px;box-shadow:0 8px 28px rgba(2,6,23,.45);color:white;overflow:hidden;cursor:pointer;font-weight:800}
.event .loc{display:block;font-weight:600;font-size:12px;color:rgba(255,255,255,0.9);opacity:0.95}
.event.break{font-weight:700;color:var(--text);box-shadow:none;border-radius:8px;padding:6px 8px;opacity:0.96}
.event.small{font-weight:700;font-size:13px}
.legend{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.sw{width:12px;height:12px;border-radius:4px}
.now-line{position:absolute;height:2px;left:0;right:0;background:var(--now);z-index:50;box-shadow:0 0 8px var(--now)}
.next-card{margin-top:8px;padding:12px;background:var(--card);border-radius:12px;border:1px solid rgba(255,255,255,0.03);font-weight:700;display:flex;justify-content:space-between;align-items:center}
.info-pop{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:var(--card);padding:14px;border-radius:14px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 20px 60px rgba(2,6,23,.6);z-index:120;max-width:92%;width:420px}
.info-pop h3{margin:0 0 6px}
.close-x{position:absolute;right:12px;top:10px;opacity:0.8}
.footer{margin-top:14px;color:var(--muted);font-size:13px}
.smallmuted{color:var(--muted);font-weight:600;font-size:13px}
@media(max-width:720px){
  .sidebar{display:none}
  .day-col{min-width:100%}
  .layout{flex-direction:column}
  .hours{display:none}
  .canvas{padding:6px}
  .hour{height:56px}
}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="title">College Schedule — Timeline</div>
    <div class="controls">
      <div class="smallmuted" id="dateNow">—</div>
    </div>
  </div>

  <div class="tabs" id="dayTabs"></div>

  <div class="next-card" id="nextCard">
    <div>
      <div class="smallmuted">Next</div>
      <div id="nextTitle">Loading…</div>
      <div class="smallmuted" id="nextWhen"></div>
    </div>
    <div class="smallmuted" id="countdown">—</div>
  </div>

  <div class="layout">
    <div class="sidebar">
      <div class="smallmuted" style="padding:6px 4px">Hours</div>
      <div class="hours" id="hoursCol"></div>
      <div class="legend" id="legend"></div>
      <div class="footer">Tip: Save to Reading List for offline caching. Add to Home Screen for one-tap.</div>
    </div>

    <div class="canvas" id="canvas" role="main" aria-label="Schedule timeline">
      <div id="dayContainer"></div>
    </div>
  </div>
</div>

<!-- info popup -->
<div id="infoPop" class="info-pop" style="display:none">
  <button class="close-x" id="closePop">✕</button>
  <h3 id="popTitle"></h3>
  <div id="popWhen" class="smallmuted"></div>
  <div id="popLoc" style="margin-top:8px"></div>
  <div id="popDates" class="smallmuted" style="margin-top:8px"></div>
</div>

<script>
// ====== Data ======
const CLASSES = [
  {title:"Math 1314", id:"MATH", days:["MO","WE","FR"], start:"08:30", end:"09:25", loc:"WHT 104", startDate:"2025-08-25", endDate:"2025-12-10"},
  {title:"ENGL 1301", id:"ENGL", days:["MO","WE","FR"], start:"09:40", end:"10:35", loc:"BLK 206", startDate:"2025-08-25", endDate:"2025-12-10"},
  {title:"BIOL 1370", id:"BIOL1370", days:["MO","WE","FR"], start:"12:00", end:"12:55", loc:"AIC 126", startDate:"2025-08-25", endDate:"2025-12-10"},
  {title:"UNIV 1201", id:"UNIV", days:["TU","TH"], start:"08:30", end:"09:25", loc:"BLK 221", startDate:"2025-08-26", endDate:"2025-12-11"},
  {title:"HIST 1301", id:"HIST", days:["TU","TH"], start:"11:40", end:"13:00", loc:"AIC 223", startDate:"2025-08-26", endDate:"2025-12-11"},
  {title:"BIOL 1170 (Lab)", id:"BIOL1170", days:["FR"], start:"14:00", end:"17:00", loc:"AIC 107", startDate:"2025-08-29", endDate:"2025-12-05"},
  // Homeroom Tue 1:05pm - 2:00pm
  {title:"Homeroom", id:"HOMEROOM", days:["TU"], start:"13:05", end:"14:00", loc:"STAGGS", startDate:"2025-08-26", endDate:"2025-12-11"}
];

const COLORS = {
  "MATH":"#2563eb","ENGL":"#16a34a","BIOL1370":"#8b5cf6","UNIV":"#f59e0b","HIST":"#ef4444","BIOL1170":"#06b6d4","HOMEROOM":"#9a7d12","BREAK":"#6b7280"
};

const DOW = ["SU","MO","TU","WE","TH","FR","SA"];

// ====== Utilities ======
function toMinutes(t){ const [h,m]=t.split(":").map(Number); return h*60+m; }
function fmtTime(t){
  let [h,m]=t.split(":").map(Number);
  const am = h<12? "am":"pm";
  h = ((h+11)%12)+1;
  return `${h}:${String(m).padStart(2,"0")}${am}`;
}
function todayLabel(d){ return d.toLocaleDateString(undefined,{weekday:"long",month:"short",day:"numeric"}); }
function minutesToLabel(m){ if(m>=60) return `${Math.floor(m/60)}h ${m%60}m`; return `${m}m`; }

// builds events for a given date: classes that occur that weekday and within date range
function eventsForDate(date){
  const dow = DOW[date.getDay()];
  const list = [];
  for(const c of CLASSES){
    if(!c.days.includes(dow)) continue;
    const s = new Date(c.startDate), e = new Date(c.endDate);
    if(date < s || date > e) continue;
    list.push({...c});
  }
  list.sort((a,b)=>toMinutes(a.start)-toMinutes(b.start));
  // insert breaks between consecutive classes
  const items = [];
  for(let i=0;i<list.length;i++){
    items.push({...list[i], type:"class"});
    const cur = list[i], next = list[i+1];
    if(next){
      const endM = toMinutes(cur.end), startM = toMinutes(next.start);
      if(startM > endM){
        items.push({title:"Break", id:"BREAK", type:"break", start:cur.end, end:next.start, detail:`Between ${cur.title} and ${next.title}`});
      }
    }
  }
  // end-of-day break until 4pm Mon-Thu
  if(["MO","TU","WE","TH"].includes(dow) && list.length){
    const last = list[list.length-1];
    if(toMinutes(last.end) < 16*60){
      items.push({title:"Break until 4pm", id:"BREAK", type:"break", start:last.end, end:"16:00", detail:`After ${last.title}`});
    }
  }
  return items;
}

// timeline rendering
const hoursStart = 7, hoursEnd = 20; // 7am - 8pm
const hourHeight = 48; // px per hour

function buildHours(){
  const hoursCol = document.getElementById("hoursCol");
  hoursCol.innerHTML = "";
  for(let h=hoursStart; h<=hoursEnd; h++){
    const hr = document.createElement("div"); hr.className="hour"; hr.textContent = ( (h%12===0?12:h%12) + ":00" );
    hoursCol.appendChild(hr);
  }
}

function renderTabs(){
  const tabs = document.getElementById("dayTabs");
  tabs.innerHTML = "";
  const labels = ["Mon","Tue","Wed","Thu","Fri"];
  for(let i=1;i<=5;i++){
    const b = document.createElement("button");
    b.className="tab"; b.textContent = labels[i-1];
    b.dataset.idx = i;
    b.onclick = ()=> { selectDay(i); };
    tabs.appendChild(b);
  }
}

let selectedDayIndex = (new Date()).getDay(); if(selectedDayIndex===0) selectedDayIndex=1;
function selectDay(idx){
  selectedDayIndex = idx;
  const tabs = document.querySelectorAll(".tab");
  tabs.forEach(t=> t.classList.toggle("active", Number(t.dataset.idx)===idx));
  renderDay(idx);
}

// draw one day's timeline into canvas
function renderDay(idx){
  const canvas = document.getElementById("dayContainer");
  canvas.innerHTML = "";
  const container = document.createElement("div"); container.className="day-col"; container.style.minHeight = ((hoursEnd-hoursStart+1)*hourHeight) + "px";
  // grid lines
  for(let h=hoursStart; h<=hoursEnd; h++){
    const g = document.createElement("div"); g.className="grid-line"; g.style.top = ((h-hoursStart)*hourHeight) + "px";
    container.appendChild(g);
  }
  // date for this week's day
  const now = new Date();
  const theDate = new Date(now);
  // compute the date corresponding to this week's idx (Mon=1)
  const curDow = (now.getDay()===0)?7:now.getDay();
  const delta = idx - curDow;
  theDate.setDate(now.getDate() + delta);

  // events
  const items = eventsForDate(theDate);
  for(const it of items){
    const sMin = toMinutes(it.start), eMin = toMinutes(it.end);
    const top = ((sMin/60)-hoursStart)*hourHeight;
    const hPx = ((eMin - sMin)/60)*hourHeight;
    const el = document.createElement("div");
    el.className = "event " + (it.type==="break" ? "break small":"small");
    el.style.top = Math.max(0, top)+"px";
    el.style.height = Math.max(28, hPx-6)+"px";
    el.style.left = "6px"; el.style.right = "6px"; el.style.position="absolute";
    const color = it.type==="break" ? "var(--break)" : (COLORS[it.id] || "#4f46e5");
    el.style.background = it.type==="break" ? "linear-gradient(180deg, rgba(107,114,128,0.12), transparent)" : color;
    el.style.borderLeft = "6px solid "+color;
    el.innerHTML = `<div class="name">${it.title}</div><div class="loc">${it.type==="break"? (it.detail||"Break") : it.loc}</div>`;
    el.onclick = ()=> showInfo(it);
    container.appendChild(el);
  }

  // now-line if today
  const today = new Date();
  const todayIdx = (today.getDay()===0)?7:today.getDay();
  if( todayIdx === idx ){
    const nowM = today.getHours()*60 + today.getMinutes();
    if(nowM >= hoursStart*60 && nowM <= hoursEnd*60){
      const y = ((nowM/60)-hoursStart)*hourHeight;
      const nl = document.createElement("div"); nl.className="now-line"; nl.style.top = y+"px";
      container.appendChild(nl);
    }
  }

  canvas.appendChild(container);
  document.getElementById("dateNow").textContent = todayLabel(theDate);
  updateNext(theDate);
}

// next class calculation and UI
function updateNext(theDate){
  const now = new Date();
  const items = eventsForDate(theDate);
  const nowM = now.getHours()*60 + now.getMinutes();
  let next = null, ongoing=null;
  for(const it of items){
    const s = toMinutes(it.start), e = toMinutes(it.end);
    if(nowM < s && !next) next = it;
    if(nowM >= s && nowM < e){ ongoing=it; break; }
  }
  const titleEl = document.getElementById("nextTitle");
  const whenEl = document.getElementById("nextWhen");
  const cnt = document.getElementById("countdown");
  if(ongoing){
    titleEl.textContent = ongoing.title;
    whenEl.textContent = `${fmtTime(ongoing.start)}–${fmtTime(ongoing.end)} • ${ongoing.loc || (ongoing.detail||"")}`;
    startCountdown(toMinutes(ongoing.end));
  } else if(next){
    titleEl.textContent = next.title;
    whenEl.textContent = `${fmtTime(next.start)}–${fmtTime(next.end)} • ${next.loc || (next.detail||"")}`;
    startCountdown(toMinutes(next.start));
  } else {
    titleEl.textContent = "No more events";
    whenEl.textContent = "You're done for the day 🎉";
    cnt.textContent = "—";
  }
}

let countdownTimer = null;
function startCountdown(targetMin){
  if(countdownTimer) clearInterval(countdownTimer);
  const cnt = document.getElementById("countdown");
  function tick(){
    const now = new Date(); const nowM = now.getHours()*60 + now.getMinutes();
    const delta = targetMin - nowM;
    if(delta <= 0){ cnt.textContent = "Now"; clearInterval(countdownTimer); return; }
    cnt.textContent = minutesToLabel(delta);
  }
  tick();
  countdownTimer = setInterval(tick, 1000*30);
}

// popup
function showInfo(it){
  const pop = document.getElementById("infoPop");
  document.getElementById("popTitle").textContent = it.title;
  document.getElementById("popWhen").textContent = `${fmtTime(it.start)} — ${fmtTime(it.end)}`;
  document.getElementById("popLoc").textContent = it.loc || (it.detail || "");
  document.getElementById("popDates").textContent = `Dates: ${it.startDate || ""} — ${it.endDate || ""}`;
  pop.style.display = "block";
}
document.getElementById("closePop").onclick = ()=> document.getElementById("infoPop").style.display="none";

// init
buildHours();
renderTabs();
const todayIndex = (new Date()).getDay()===0?1:(new Date()).getDay();
selectDay(todayIndex);

// legend
(function buildLegend(){
  const lg = document.getElementById("legend");
  const items = ["MATH","ENGL","BIOL1370","UNIV","HIST","BIOL1170","HOMEROOM","BREAK"];
  for(const id of items){
    const sw = document.createElement("div"); sw.style.display="flex"; sw.style.alignItems="center"; sw.style.gap="8px";
    const box = document.createElement("div"); box.className="sw"; box.style.background = COLORS[id] || "#6b7280";
    const label = document.createElement("div"); label.textContent = (id==="BREAK"?"Breaks": (id==="BIOL1370"?"BIOL 1370": id==="BIOL1170"?"BIOL 1170 (Lab)": id.charAt(0).toUpperCase()+id.slice(1).toLowerCase()));
    label.style.fontSize="13px"; label.style.color="var(--muted)";
    sw.appendChild(box); sw.appendChild(label); lg.appendChild(sw);
  }
})();

// refresh now-line and countdown each minute
setInterval(()=>{ renderDay(selectedDayIndex); }, 60000);

</script>
</body>
</html>
